<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式协调：zookeeper入门 | Fun Notes</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.3e464078.css" as="style"><link rel="preload" href="/assets/js/app.764657af.js" as="script"><link rel="preload" href="/assets/js/3.13400d0e.js" as="script"><link rel="preload" href="/assets/js/1.f6a48a09.js" as="script"><link rel="preload" href="/assets/js/89.372b764c.js" as="script"><link rel="prefetch" href="/assets/js/10.2f5634d0.js"><link rel="prefetch" href="/assets/js/100.5e7903ac.js"><link rel="prefetch" href="/assets/js/101.870f93ef.js"><link rel="prefetch" href="/assets/js/102.22b9705c.js"><link rel="prefetch" href="/assets/js/103.560ad7c9.js"><link rel="prefetch" href="/assets/js/104.c8f84255.js"><link rel="prefetch" href="/assets/js/105.1c3ec0e0.js"><link rel="prefetch" href="/assets/js/106.c68aa3da.js"><link rel="prefetch" href="/assets/js/107.3aebb4fb.js"><link rel="prefetch" href="/assets/js/108.b0a39856.js"><link rel="prefetch" href="/assets/js/109.1dfe587e.js"><link rel="prefetch" href="/assets/js/11.8930fb63.js"><link rel="prefetch" href="/assets/js/110.d9c29693.js"><link rel="prefetch" href="/assets/js/111.ee35ba5e.js"><link rel="prefetch" href="/assets/js/112.8e9714cc.js"><link rel="prefetch" href="/assets/js/113.b0692777.js"><link rel="prefetch" href="/assets/js/12.c37223c1.js"><link rel="prefetch" href="/assets/js/13.07ddb5f0.js"><link rel="prefetch" href="/assets/js/14.85096f2f.js"><link rel="prefetch" href="/assets/js/15.f9725d75.js"><link rel="prefetch" href="/assets/js/16.0732d9db.js"><link rel="prefetch" href="/assets/js/17.51607509.js"><link rel="prefetch" href="/assets/js/18.254b6195.js"><link rel="prefetch" href="/assets/js/19.059e57c0.js"><link rel="prefetch" href="/assets/js/20.c42dc7c4.js"><link rel="prefetch" href="/assets/js/21.23f80bf2.js"><link rel="prefetch" href="/assets/js/22.cccb2697.js"><link rel="prefetch" href="/assets/js/23.ecd2a693.js"><link rel="prefetch" href="/assets/js/24.4990f380.js"><link rel="prefetch" href="/assets/js/25.d14c589f.js"><link rel="prefetch" href="/assets/js/26.235046fb.js"><link rel="prefetch" href="/assets/js/27.e6f9ec4b.js"><link rel="prefetch" href="/assets/js/28.36b50c2d.js"><link rel="prefetch" href="/assets/js/29.d4eea3d3.js"><link rel="prefetch" href="/assets/js/30.eb7ed9ba.js"><link rel="prefetch" href="/assets/js/31.340ea671.js"><link rel="prefetch" href="/assets/js/32.ce34aba9.js"><link rel="prefetch" href="/assets/js/33.d1180fb6.js"><link rel="prefetch" href="/assets/js/34.aad04170.js"><link rel="prefetch" href="/assets/js/35.19cbbcf3.js"><link rel="prefetch" href="/assets/js/36.508c441c.js"><link rel="prefetch" href="/assets/js/37.2f0fcbd3.js"><link rel="prefetch" href="/assets/js/38.9b05935c.js"><link rel="prefetch" href="/assets/js/39.6a4a922d.js"><link rel="prefetch" href="/assets/js/4.e1d8719a.js"><link rel="prefetch" href="/assets/js/40.736ecb52.js"><link rel="prefetch" href="/assets/js/41.00f28811.js"><link rel="prefetch" href="/assets/js/42.045b67b0.js"><link rel="prefetch" href="/assets/js/43.56f181a3.js"><link rel="prefetch" href="/assets/js/44.f4d3babb.js"><link rel="prefetch" href="/assets/js/45.67a6063d.js"><link rel="prefetch" href="/assets/js/46.c516c869.js"><link rel="prefetch" href="/assets/js/47.cde618c9.js"><link rel="prefetch" href="/assets/js/48.e84aac87.js"><link rel="prefetch" href="/assets/js/49.90ff3d6e.js"><link rel="prefetch" href="/assets/js/5.c15e8f4c.js"><link rel="prefetch" href="/assets/js/50.2a5437e5.js"><link rel="prefetch" href="/assets/js/51.fb4cd3e5.js"><link rel="prefetch" href="/assets/js/52.f5732102.js"><link rel="prefetch" href="/assets/js/53.46f9c65b.js"><link rel="prefetch" href="/assets/js/54.6146213a.js"><link rel="prefetch" href="/assets/js/55.acf37d27.js"><link rel="prefetch" href="/assets/js/56.e0d3e571.js"><link rel="prefetch" href="/assets/js/57.8baac978.js"><link rel="prefetch" href="/assets/js/58.1e361eae.js"><link rel="prefetch" href="/assets/js/59.8ffe4144.js"><link rel="prefetch" href="/assets/js/6.983ea4f6.js"><link rel="prefetch" href="/assets/js/60.e1b69b91.js"><link rel="prefetch" href="/assets/js/61.61a060f7.js"><link rel="prefetch" href="/assets/js/62.95d8a4dc.js"><link rel="prefetch" href="/assets/js/63.6573cc41.js"><link rel="prefetch" href="/assets/js/64.e8472603.js"><link rel="prefetch" href="/assets/js/65.1eb766df.js"><link rel="prefetch" href="/assets/js/66.a981fa78.js"><link rel="prefetch" href="/assets/js/67.436bc8b4.js"><link rel="prefetch" href="/assets/js/68.e4d77ed7.js"><link rel="prefetch" href="/assets/js/69.c5f0385a.js"><link rel="prefetch" href="/assets/js/7.ba12fc64.js"><link rel="prefetch" href="/assets/js/70.44fed116.js"><link rel="prefetch" href="/assets/js/71.0347fd74.js"><link rel="prefetch" href="/assets/js/72.97e8abbf.js"><link rel="prefetch" href="/assets/js/73.5e815637.js"><link rel="prefetch" href="/assets/js/74.09605769.js"><link rel="prefetch" href="/assets/js/75.1bc7721c.js"><link rel="prefetch" href="/assets/js/76.ba837ea4.js"><link rel="prefetch" href="/assets/js/77.49dc26f2.js"><link rel="prefetch" href="/assets/js/78.02a4e9f8.js"><link rel="prefetch" href="/assets/js/79.72ea4189.js"><link rel="prefetch" href="/assets/js/8.40b43baf.js"><link rel="prefetch" href="/assets/js/80.761448a1.js"><link rel="prefetch" href="/assets/js/81.6283dd53.js"><link rel="prefetch" href="/assets/js/82.e62e638e.js"><link rel="prefetch" href="/assets/js/83.c14d1896.js"><link rel="prefetch" href="/assets/js/84.ac9c3b47.js"><link rel="prefetch" href="/assets/js/85.3ac0f5e3.js"><link rel="prefetch" href="/assets/js/86.e90b8fb1.js"><link rel="prefetch" href="/assets/js/87.e259ebf6.js"><link rel="prefetch" href="/assets/js/88.382047e5.js"><link rel="prefetch" href="/assets/js/9.e76ee2e9.js"><link rel="prefetch" href="/assets/js/90.d4c8fcbc.js"><link rel="prefetch" href="/assets/js/91.b4e1e7d1.js"><link rel="prefetch" href="/assets/js/92.4f9612d1.js"><link rel="prefetch" href="/assets/js/93.ee6863a6.js"><link rel="prefetch" href="/assets/js/94.997b5bc9.js"><link rel="prefetch" href="/assets/js/95.989059cc.js"><link rel="prefetch" href="/assets/js/96.ab3cf4de.js"><link rel="prefetch" href="/assets/js/97.5698f03d.js"><link rel="prefetch" href="/assets/js/98.90155afd.js"><link rel="prefetch" href="/assets/js/99.79dc109a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3e464078.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>Fun Notes</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Fun Notes</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="Fun Notes" class="logo"> <span class="site-name">Fun Notes</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/00-java/" class="nav-link"><i class="iconfont "></i>
  基础知识
</a></div><div class="nav-item"><a href="/01-database/" class="nav-link"><i class="iconfont "></i>
  数据库
</a></div><div class="nav-item"><a href="/02-algorithm/" class="nav-link"><i class="iconfont "></i>
  算法设计
</a></div><div class="nav-item"><a href="/03-framework/" class="nav-link"><i class="iconfont "></i>
  基础组件
</a></div><div class="nav-item"><a href="/04-architecture/" class="nav-link router-link-active"><i class="iconfont "></i>
  架构&amp;分布式
</a></div><div class="nav-item"><a href="/05-bigdata/" class="nav-link"><i class="iconfont "></i>
  大数据
</a></div><div class="nav-item"><a href="/06-tool/" class="nav-link"><i class="iconfont "></i>
  工具&amp;部署
</a></div><div class="nav-item"><a href="/08-about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div><div class="nav-item"><a href="https://github.com/funye/funye.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="/images/avatar.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    Fun Notes
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>70</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>61</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/00-java/" class="nav-link"><i class="iconfont "></i>
  基础知识
</a></div><div class="nav-item"><a href="/01-database/" class="nav-link"><i class="iconfont "></i>
  数据库
</a></div><div class="nav-item"><a href="/02-algorithm/" class="nav-link"><i class="iconfont "></i>
  算法设计
</a></div><div class="nav-item"><a href="/03-framework/" class="nav-link"><i class="iconfont "></i>
  基础组件
</a></div><div class="nav-item"><a href="/04-architecture/" class="nav-link router-link-active"><i class="iconfont "></i>
  架构&amp;分布式
</a></div><div class="nav-item"><a href="/05-bigdata/" class="nav-link"><i class="iconfont "></i>
  大数据
</a></div><div class="nav-item"><a href="/06-tool/" class="nav-link"><i class="iconfont "></i>
  工具&amp;部署
</a></div><div class="nav-item"><a href="/08-about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div><div class="nav-item"><a href="https://github.com/funye/funye.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构理论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/04-architecture/theory/000-theory.html" class="sidebar-link">架构知识体系</a></li><li><a href="/04-architecture/theory/021-ratelimit.html" class="sidebar-link">高并发：限流</a></li><li><a href="/04-architecture/theory/022-ds-reduce.html" class="sidebar-link">高并发：熔断与降级</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/04-architecture/ds/002-microservice.html" class="sidebar-link">分布式：微服务设计思路</a></li><li><a href="/04-architecture/ds/01-ds-theory.html" class="sidebar-link">分布式：基本理论与一致性</a></li><li><a href="/04-architecture/ds/010-ds-id.html" class="sidebar-link">分布式：全局唯一ID实现方案</a></li><li><a href="/04-architecture/ds/011-ds-lock.html" class="sidebar-link">分布式：分布式锁及实现方案</a></li><li><a href="/04-architecture/ds/03-message.html" class="sidebar-link">分布式：消息队列的使用方案</a></li><li><a href="/04-architecture/ds/04-cache-consistency.html" class="sidebar-link">分布式：缓存一致性问题</a></li><li><a href="/04-architecture/ds/05-ds-transaction.html" class="sidebar-link">分布式：事务的解决方案</a></li><li><a href="/04-architecture/ds/06-ds-job.html" class="sidebar-link">分布式：任务调度方案</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>分布式组件</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/04-architecture/ds-framework/001-rocketmq.html" class="sidebar-link">分布式消息：RocketMQ</a></li><li><a href="/04-architecture/ds-framework/002-kafka.html" class="sidebar-link">分布式消息：kakfa</a></li><li><a href="/04-architecture/ds-framework/0021-kafka-more.html" class="sidebar-link">分布式消息：kakfa</a></li><li><a href="/04-architecture/ds-framework/003-redis.html" class="sidebar-link">分布式缓存：Redis基础入门</a></li><li><a href="/04-architecture/ds-framework/004-redis-use.html" class="sidebar-link">分布式组件：Redis使用场景与用法</a></li><li><a href="/04-architecture/ds-framework/005-redis-ha.html" class="sidebar-link">分布式缓存：高可用的redis服务</a></li><li><a href="/04-architecture/ds-framework/006-dubbo.html" class="sidebar-link">分布式RPC：DUBBO</a></li><li><a href="/04-architecture/ds-framework/007-springcloud.html" class="sidebar-link">微服务：Spring Cloud</a></li><li><a href="/04-architecture/ds-framework/008-zookeeper.html" aria-current="page" class="active sidebar-link">分布式协调：zookeeper入门</a></li><li><a href="/04-architecture/ds-framework/0081-zab.html" class="sidebar-link">分布式协调：zookeeper中的ZAB协议</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构示例</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/04-architecture/case/s-kill.html" class="sidebar-link">秒杀场景的高并发</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>Fun Notes</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-2d5f533b><main class="page"><div class="page-title" style="display:none;"><h1 class="title">分布式协调：zookeeper入门</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>Fun Notes</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h1 id="分布式协调-zookeeper入门"><a href="#分布式协调-zookeeper入门" class="header-anchor">#</a> 分布式协调：zookeeper入门</h1> <h1 id="_1-zookeeper网站"><a href="#_1-zookeeper网站" class="header-anchor">#</a> 1 zookeeper网站</h1> <p><a href="http://zookeeper.majunwei.com/document/3.4.6/DeveloperProgrammerGuide.html" target="_blank" rel="noopener noreferrer">Zookeeper中文网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://zookeeper.apache.org/doc/r3.4.6/zookeeperProgrammers.html#ch_gotchas" target="_blank" rel="noopener noreferrer">Zookeeepr英文官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>以上是zookeeper的学习网站，可以先看中文快速了解基础的概念，再看英文原版，从而保证理解上面经量少的偏差</p> <h1 id="_2-zookeeper的安装和使用入门"><a href="#_2-zookeeper的安装和使用入门" class="header-anchor">#</a> 2 zookeeper的安装和使用入门</h1> <h2 id="_2-1-zookeeper安装与启动"><a href="#_2-1-zookeeper安装与启动" class="header-anchor">#</a> 2.1 zookeeper安装与启动</h2> <p><strong>1 安装启动</strong></p> <p>在官方网站下载安装包之后，解压到喜欢的文件，在conf目录下创建一个zoo.cfg 文件作为配置文件,内容如下</p> <div class="language- extra-class"><pre class="language-text"><code>tickTime=2000
dataDir=/var/lib/zookeeper
clientPort=2181
</code></pre></div><p><strong>tickTime:</strong> 在zookeeper体系中，以毫秒的为单位的基础时间单位值。用作心跳检测和session过期（两倍的tickTime时间）</p> <p><strong>dataDir:</strong> 存储目录</p> <p><strong>clientPort:</strong> 客户端连接时使用的端口</p> <p>配置完成之后。执行安装目录下bin目录里面的 <code>zkServer.sh</code>, 例如：<code>/bin/zkServer.sh start</code> ,启动服务</p> <p><strong>2 客户端连接</strong></p> <p>执行安装目录下的zkCli.sh 脚本使用命令行连接，<code>bin/zkCli.sh -server 127.0.0.1:2181</code></p> <p>连接进入之后，使用help可以看到一些操作命令，例如</p> <div class="language- extra-class"><pre class="language-text"><code>`ls /` 查看根目录下面的节点
`create` 创建节点，例如 create /zk_test my_test_data ,在根目录下创建zk_test
`set` 设置节点的值，例如 set /zk_test my_new_test_data
`get` 获取节点的值， 例如 get /zk_test 
`delete` 删除节点，例如 delete /zk_testls
</code></pre></div><p><em>在zookeeper里面，所有的节点都是一个路径，例如在zk_test下面创建一个test节点，就需要知名路径，create /zk_test/test test_data,所有操作中path 参数从根目录开始</em></p> <h2 id="_2-2-zookeeper主从-replicated-zookeeper"><a href="#_2-2-zookeeper主从-replicated-zookeeper" class="header-anchor">#</a> 2.2 zookeeper主从（replicated zookeeper）</h2> <p>主从模式配置和单点模式基本很相似，只是多加入了几个配置</p> <div class="language- extra-class"><pre class="language-text"><code>tickTime=2000
dataDir=/var/lib/zookeeper
clientPort=2181
initLimit=5
syncLimit=2
server.1=zoo1:2888:3888
server.2=zoo2:2888:3888
server.3=zoo3:2888:3888
</code></pre></div><p>其中</p> <p><strong>initLimit</strong>: 设置参与的机器（quorum）连接到leader的超时时间，单位为tickTime设置的时间，如上配置 这个时间=2000*5=10000ms=10s</p> <p><strong>syncLimit</strong>: 设置从机器到leader的延时时间上限</p> <p><strong>server.x</strong> 代表服务器的，其中有一个是master，建议最少使用三台以上服务，zookeeper和redis有点像，使用选举的策略，所以，最好是奇数的服务器数量。 server name后面的两个端口，前面的端口用来连接follower和leader，当新的leader选出来之后，follower就通过这个端口和leader建立连接。后面的端口是作为leader选举时候的端口</p> <h1 id="_3-zookeeper"><a href="#_3-zookeeper" class="header-anchor">#</a> 3 zookeeper</h1> <p>了解zookeeper的时候，四个最重要的元素一定要知道 ，数据结构(node/Sate)，Session, Watcher, ACL，从这开始，依次来了解这些东西</p> <h2 id="_3-1-zookeeper的数据结构"><a href="#_3-1-zookeeper的数据结构" class="header-anchor">#</a> 3.1 zookeeper的数据结构</h2> <p>zookeeper是一个分层的命名空间(hierarchal name space) ,非常像一个分布式文件系统。命令空间的每个节点可以有自己的数据和子节点。zookeeper的子节点称之为znode,znode维护了一个stat的数据结构</p> <h3 id="_3-1-1-zookeeper计时"><a href="#_3-1-1-zookeeper计时" class="header-anchor">#</a> 3.1.1 zookeeper计时</h3> <p>Zookeeper通过多种方式追踪计时：</p> <p><strong>Zxid</strong></p> <p>每个Zookeeper状态的变化都以zxid(事务ID)的形式接收到标记。这个暴露了Zookeeper所有变化的总排序。每个变化都会有一个zxid，并且如果zxid1早于zxid2则zxid1一定小于zxid2。</p> <p><strong>版本号</strong></p> <p>节点的每个变化都会引起那个节点的版本号的其中之一增加。这三个版本号是dataVersion(znode的数据变化版本号),cversion(子目录的变化版本号)，和aclVersion(访问控制列表的变化版本号)。</p> <p><strong>Ticks</strong></p> <p>当使用多服务器的Zookeeper时，服务器使用ticks定义事件的时间，如状态上传，会话超时，同事之间的连接超时等等。tick次数只是通过最小的会话超时间接的暴露；如果一个客户端请求会话超时小于最小的会话超时，服务器就会告诉客户端会话超时实际上是最低会话超时时间。</p> <p><strong>Real time</strong></p> <p>Zookeeper不使用实时或时钟时间，除了将时间戳加在znode创建和更新的stat结构上。</p> <h3 id="_3-1-2-stat数据结构"><a href="#_3-1-2-stat数据结构" class="header-anchor">#</a> 3.1.2 stat数据结构</h3> <p>执行 get命令查看一个节点的时候就可以看到，例如 get /zk_test</p> <div class="language- extra-class"><pre class="language-text"><code>my_test_data
cZxid = 0x8
ctime = Fri Jun 23 11:05:38 CST 2017
mZxid = 0x8
mtime = Fri Jun 23 11:05:38 CST 2017
pZxid = 0xa
cversion = 2
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 12
numChildren = 0
</code></pre></div><p>my_test_data 使我们存放的数据</p> <h2 id="_3-2-zookeeper-session"><a href="#_3-2-zookeeper-session" class="header-anchor">#</a> 3.2 zookeeper session</h2> <p>主要是控制会话状态</p> <p>下面是官网提供的状态转换图：
<img src="http://upload-images.jianshu.io/upload_images/4752922-f457dc7a6c9de5d2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="zookeeper sessopn状体图"></p> <h2 id="_3-3-zookeeper-watcher-重点"><a href="#_3-3-zookeeper-watcher-重点" class="header-anchor">#</a> 3.3 zookeeper watcher(重点)</h2> <h3 id="_3-3-1-什么事watcher"><a href="#_3-3-1-什么事watcher" class="header-anchor">#</a> 3.3.1 什么事watcher</h3> <p>zookeeper的读操作，- getData(), getChildren(), and exists() ，都可以设置watcher. zookeeper中关于watch的定义是： <strong>当设置了watch的节点的数据发生了变化的时候，会向客户端发送一次（one-time trigger）watch的事件。（a watch event is one-time trigger, sent to the client that set the watch, which occurs when the data for which the watch was set changes）</strong>。</p> <p>针对这个定义，有下面三个方面的结论：</p> <blockquote><ol><li><strong>一次触发</strong>：当数据有了变化时将向客户端发送一个watch事件。例如，如果一个客户端用getData(&quot;/znode1&quot;,true)并且过一会之后/znode1的数据改变或删除了，客户端将获得一个/znode1的watch事件。如果/znode1再次改变，将不会发送watch事件除非设置了新watch。</li> <li><strong>发往客户端</strong>:  这意味着事件发往客户端，但是可能在成功之前没到客户端。Watches是异步发往watchers。Zookeeper提供一个顺序保证：在看到watch事件之前绝不会看到变化。网络延迟或其他因素可能引起客户端看到watches并在不同时间返回code。关键点是不同客户端看到的是一致性的顺序。</li> <li><strong>为数据设置watch</strong>:  一个节点可以有不同方式改变。它帮助Zookeeper维护两个watches：data watches和child watches。getData()和exists()设置data watches。getChildren()设置child watches。两者任选其一，它可以帮助watches根据类型返回。getData()和exists()返回关于节点数据的信息，然而getChildren()返回children列表。因此，setData()将会触发znode设置的data watches。一个成功的create()将会触发一个datawatches和一个父节点的child watch。一个成功的delete()将触发一个data watch和一个child watch</li></ol></blockquote> <p><strong>watch事件类型列表及其触发方法</strong></p> <ul><li>Created event:
Enabled with a call to exists.</li> <li>Deleted event:
Enabled with a call to exists, getData, and getChildren.</li> <li>Changed event:
Enabled with a call to exists and getData.</li> <li>Child event:
Enabled with a call to getChildren.</li></ul> <h3 id="_3-3-2-watch作用"><a href="#_3-3-2-watch作用" class="header-anchor">#</a> 3.3.2 watch作用</h3> <p>zookeeper设置了watch,只要作用是什么呢</p> <ol><li>Watches和其他事件、watches和异步恢复都是有序的。Zookeeper客户端保证每件事都是有序派发</li> <li>当添加的watch的节点改变的了数据的时候，客户端会先看到watch事件，之后才看到新数据</li> <li>watch事件的顺序是和服务的数据改变的顺序是一致的</li></ol> <h2 id="_3-4-zookeeper-acl访问控制"><a href="#_3-4-zookeeper-acl访问控制" class="header-anchor">#</a> 3.4 zookeeper ACL访问控制</h2> <p>acl主要是对zookeeper的node做访问权限的控制，但是，这个访问权限是不递归到子元素的，也就是说，给node /test_node 设置的权限只会影响 /test_node ，不会影响他的子节点。</p> <p>ACLs由对组成(scheme:expression,permissions)。expression的格式是针对scheme。</p> <h3 id="_3-4-1-acl-默认的权限如下"><a href="#_3-4-1-acl-默认的权限如下" class="header-anchor">#</a> 3.4.1 ACL 默认的权限如下：</h3> <ul><li>CREATE: you can create a child node (可以创建 <strong>子节点</strong>)</li> <li>READ: you can get data from a node and list its children.(可以查看节点数据和列出他的子节点)</li> <li>WRITE: you can set data for a node (可以向节点设置数据)</li> <li>DELETE: you can delete a child node (可以删除 <strong>子节点</strong>)</li> <li>ADMIN: you can set permissions (可以设置节点的权限)</li></ul> <p>在命令行创建的时候，直接使用cdrwa分别代表 create,delete,read,write,admin权限</p> <h3 id="_3-4-2-acl-内置的scheme"><a href="#_3-4-2-acl-内置的scheme" class="header-anchor">#</a> 3.4.2 ACL 内置的scheme</h3> <p>Zookeeper有下面的schemes：</p> <p>world：有单独的id，anyone,代表任何人, 例如节点得默认权限 world:anyone:cdrwa
auth:不适用任何id，代表任何授权的用户。
digest：使用username;password字符串生成MD5哈希作为ACL ID身份。通过发送username:password明文授权。在ACL里使用时expression将会是username:base64编码的SHA1 password摘要。
ip:使用客户端IP作为ACL ID身份。</p> <p>设置权限之后，要想访问，就要获得具体权限。</p> <p>示例：</p> <ol><li>命令行执行就会创建一个节点 /test_node 需要的用户名密码(fun:123123)登录</li></ol> <div class="language- extra-class"><pre class="language-text"><code>create /test_node test_acl_data auth:fun:123123:cdrwa
</code></pre></div><ol start="2"><li>查看权限 getAcl</li></ol> <div class="language- extra-class"><pre class="language-text"><code>[zk: 127.0.0.1:2181(CONNECTED) 5] getAcl /test_node
'digest,'fun:lpYnLtsL5UprZTlY9EGtvYhMZU0=
: cdrwa
</code></pre></div><p>上面执行效果发现，auth 带上id(fun:123123)的时候，会得到效果就是digest的权限设置scheme,在没有密码的情况下执行例如 get 会提示权限不够</p> <ol start="3"><li>授权之后，操作node
使用 addauth 方式授权</li></ol> <div class="language- extra-class"><pre class="language-text"><code>addauth digest fun:123123
</code></pre></div><p>之后操作就没有问题了</p> <p><strong>关于zookeeper的ACL的总结：</strong></p> <ol><li><strong>acl的权限设置是对设置的节点有作用，对子节点没有递归作用效果</strong></li> <li><strong>授权和scheme有关系，用什么scheme授权，添加授权(addauth)就用什么scheme</strong></li> <li><strong>addauth授权的生命周期同session周期一致</strong></li></ol> <h1 id="_4-zookeeper-一致性保证"><a href="#_4-zookeeper-一致性保证" class="header-anchor">#</a> 4 zookeeper 一致性保证</h1></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">5/10/2021, 10:25:08 AM</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.764657af.js" defer></script><script src="/assets/js/3.13400d0e.js" defer></script><script src="/assets/js/1.f6a48a09.js" defer></script><script src="/assets/js/89.372b764c.js" defer></script>
  </body>
</html>
