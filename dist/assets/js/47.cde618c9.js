(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{667:function(t,a,s){"use strict";s.r(a);var n=s(4),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_1-参数调试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-参数调试"}},[t._v("#")]),t._v(" 1 参数调试")]),t._v(" "),s("h3",{attrs:{id:"_1-1-gc日志参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-gc日志参数"}},[t._v("#")]),t._v(" 1.1 GC日志参数")]),t._v(" "),s("ul",[s("li",[t._v("-XX:+PrintGCDetails 打印GC详细日志")]),t._v(" "),s("li",[t._v("-XX:+HeapDumpOnOutOfMemoryError 设置当OutOfMemoryError的时候，dump堆区的情况")]),t._v(" "),s("li",[t._v("-XX:+HeapDumpBeforeFullGC 设置发现FullGC之前dump堆区信息")]),t._v(" "),s("li",[t._v("-XX:+HeapDumpAfterFullGC 设置发现FullGC之后dump堆区信息")]),t._v(" "),s("li",[t._v("-XX:HeapDumpPath 指定dump文件")]),t._v(" "),s("li",[t._v("-Xloggc 指定GC日志文件")])]),t._v(" "),s("p",[t._v("例如")]),t._v(" "),s("div",{staticClass:"language-jvm extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("-Xms2048m \n-Xmx2048m \n-Xmn1048m \n-XX:+PrintGCDetails \n-XX:+HeapDumpOnOutOfMemoryError \n-XX:+HeapDumpBeforeFullGC \n-XX:+HeapDumpAfterFullGC \n-XX:HeapDumpPath=/tmp/headoom.dump \n-Xloggc:log/gc.log\n")])])]),s("h3",{attrs:{id:"_1-2-堆区的参数控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-堆区的参数控制"}},[t._v("#")]),t._v(" 1.2 堆区的参数控制")]),t._v(" "),s("ul",[s("li",[t._v("-Xmx 堆区最大值")]),t._v(" "),s("li",[t._v("-Xms 堆区初始大小")]),t._v(" "),s("li",[t._v("-Xmn 年轻代空间")]),t._v(" "),s("li",[t._v("-XX:NewRatio 老年代:年轻代的比例， 如2 代表 young:old = 1:2")]),t._v(" "),s("li",[t._v("-XX:SurvivorRatio Eden:Survivor的比例  如8 代表 eden:s0:s1 = 8:1:1")])]),t._v(" "),s("p",[t._v("堆区内存溢出示例：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 堆溢出示例\n * 可以通过调整参数值，看看内存溢出时候GC的情况\n * VM-args:-Xms20m -Xmx20m -Xmn10m -XX:+PrintGCDetails -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=D:\\tempwork\\headoom.dump\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HeapOOM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OOMObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OOMObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tlist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OOMObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_1-3-方法区、数据元区参数控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-方法区、数据元区参数控制"}},[t._v("#")]),t._v(" 1.3 方法区、数据元区参数控制")]),t._v(" "),s("ul",[s("li",[t._v("-XX:PermSize 永久代初始大小")]),t._v(" "),s("li",[t._v("-XX:MaxPermSize （永久区，jdk8之后为metaspace）")]),t._v(" "),s("li",[t._v("-XX:MetaspaceSize=8m 元数据区初始大小")]),t._v(" "),s("li",[t._v("-XX:MaxMetaspaceSize=80m 元数据区最大值")]),t._v(" "),s("li",[t._v("-XX:CompressedClassSpaceSize=512m class压缩大小")])]),t._v(" "),s("p",[t._v("元数据区内存溢出示例")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 数据元区溢出示例\n * 数据元区存储的是类的信息，所以通过cglib不断的创建类，就可以使元数据区内存溢出，\n * 默认元数据区就是机器的物理内存，所以测试设置下最大值测试比较稳妥\n * VM-args: -Xms256m -Xmx256m -Xmn128m -XX:MetaspaceSize=5m -XX:MaxMetaspaceSize=9m -XX:+PrintGCDetails\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MetaspaceOOM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Enhancer")]),t._v(" enhancer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Enhancer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setSuperclass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MetaspaceOOMObj")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUseCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MethodInterceptor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("intercept")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MethodProxy")]),t._v(" proxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" proxy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("invokeSuper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                enhancer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"第"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"次时发生异常"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MetaspaceOOMObj")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//        public static final String test = "test";')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_1-4-栈区参数控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-栈区参数控制"}},[t._v("#")]),t._v(" 1.4 栈区参数控制")]),t._v(" "),s("ul",[s("li",[t._v("-Xss 栈空间大小")])]),t._v(" "),s("p",[t._v("栈空间大小示例：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 栈溢出示例\n * 栈存储的方法的局部变量、操作栈、动态链接、返回地址。想要它溢出，使用一个没有结束的递归调用即可。\n * VM-args: -Xss128k  -XX:+PrintGCDetails -Xloggc:log/gc.log\n * 修改Xss的值，查看调用的栈的深度\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaVMStackSOF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" stackLength "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("staticLeak")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tstackLength"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("staticLeak")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaVMStackSOF")]),t._v(" oom "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaVMStackSOF")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\toom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("staticLeak")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"static length: "')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" oom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stackLength"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//\t\t\tthrow e;")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_2-参数配置估算-内存估算"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-参数配置估算-内存估算"}},[t._v("#")]),t._v(" 2 参数配置估算(内存估算)")]),t._v(" "),s("h3",{attrs:{id:"_2-1-参数基本策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-参数基本策略"}},[t._v("#")]),t._v(" 2.1 参数基本策略")]),t._v(" "),s("blockquote",[s("p",[t._v("各分区的大小对GC的性能影响很大。如何将各分区调整到合适的大小，分析活跃数据的大小是很好的切入点。")]),t._v(" "),s("p",[t._v("活跃数据的大小是指，应用程序稳定运行时长期存活对象在堆中占用的空间大小，也就是Full GC后堆中老年代占用空间的大小。\n可以通过GC日志中Full GC之后老年代数据大小得出，比较准确的方法是在程序稳定后，多次获取GC数据，通过取平均值的方式计算活跃数据的大小。活跃数据和各分区之间的比例关系如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("空间")]),t._v(" "),s("th",[t._v("倍数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("总大小")]),t._v(" "),s("td",[t._v("3-4 倍活跃数据的大小")])]),t._v(" "),s("tr",[s("td",[t._v("新生代")]),t._v(" "),s("td",[t._v("1-1.5 活跃数据的大小")])]),t._v(" "),s("tr",[s("td",[t._v("老年代")]),t._v(" "),s("td",[t._v("2-3 倍活跃数据的大小")])]),t._v(" "),s("tr",[s("td",[t._v("永久代")]),t._v(" "),s("td",[t._v("1.2-1.5 倍Full GC后的永久代空间占用")])])])])]),t._v(" "),s("p",[t._v("例如，根据GC日志获得老年代的活跃数据大小为300M，那么各分区大小可以设为：")]),t._v(" "),s("ul",[s("li",[t._v("总堆：1200MB = 300MB × 4*")]),t._v(" "),s("li",[t._v("新生代：450MB = 300MB × 1.5*")]),t._v(" "),s("li",[t._v("老年代： 750MB = 1200MB - 450MB*")])]),t._v(" "),s("p",[t._v("这部分设置仅仅是堆大小的初始值，后面的优化中，可能会调整这些值，具体情况取决于应用程序的特性和需求。")]),t._v(" "),s("p",[t._v("参考："),s("a",{attrs:{href:"https://tech.meituan.com/2017/12/29/jvm-optimize.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从实际案例聊聊Java应用的GC优化"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_2-2-参数估算示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-参数估算示例"}},[t._v("#")]),t._v(" 2.2 参数估算示例")]),t._v(" "),s("p",[t._v("参考示例："),s("a",{attrs:{href:"https://youyou-tech.com/2019/11/22/%E6%AF%8F%E5%A4%A9%E7%99%BE%E4%B8%87%E4%BA%A4%E6%98%93%E7%9A%84%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E8%AF%A5%E6%80%8E%E4%B9%88%E8%AE%BE/",target:"_blank",rel:"noopener noreferrer"}},[t._v("每天百万交易的支付系统，生产环境该怎么设置JVM堆内存大小"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_3-问题排查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-问题排查"}},[t._v("#")]),t._v(" 3 问题排查")]),t._v(" "),s("p",[t._v("通常我们在线上遇到JVM的问题大概有两种： 内存溢出（内存占用过大）、频繁GC或者FullGC。")]),t._v(" "),s("h3",{attrs:{id:"_3-1-jvm问题常用排查工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-jvm问题常用排查工具"}},[t._v("#")]),t._v(" 3.1 JVM问题常用排查工具")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("ps")]),t._v("/"),s("code",[t._v("jps")]),t._v("，查看进程pid")]),t._v(" "),s("li",[s("code",[t._v("top -p [pid] -H")]),t._v("，top命令：Linux命令。可以查看实时的内存使用情况。")]),t._v(" "),s("li",[s("code",[t._v("jstack -l [pid] > stack.log")]),t._v("，jstack跟踪堆栈信息、线程信息。")]),t._v(" "),s("li",[s("code",[t._v("jmap -histo:live [pid]")]),t._v("，然后分析具体的对象数目和占用内存大小，从而定位代码。")]),t._v(" "),s("li",[s("code",[t._v("jmap -dump:live,format=b,file=xxx.xxx [pid]")]),t._v("，然后利用MAT工具分析是否存在内存泄漏等等。")]),t._v(" "),s("li",[t._v("使用VisualVm 进行分析")]),t._v(" "),s("li",[s("code",[t._v("pmap -x [pid]")]),t._v(" 查看进程的内存映射情况")]),t._v(" "),s("li",[t._v("jstat命令，如："),s("code",[t._v("jstat -gcutil pidxxx 1000")]),t._v(" 查看各个区空间使用情况，youngGC 和 full GC 的次数信息")])]),t._v(" "),s("h3",{attrs:{id:"_3-2-内存溢出问题处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-内存溢出问题处理"}},[t._v("#")]),t._v(" 3.2 内存溢出问题处理")]),t._v(" "),s("p",[t._v("当出现内存溢出问题的时候，首先看日志。看看错误情况。")]),t._v(" "),s("p",[t._v("此错误常见的错误提示：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PermGen")]),t._v(" space "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 方法区溢出")]),t._v("\njava"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Java")]),t._v(" heap space "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 堆区溢出")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Root")]),t._v(" cause of "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServletException")]),t._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutOfMemoryError")]),t._v("\njava"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutOfMemoryError")]),t._v("\njava"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutOfMemoryError")]),t._v("\n\n")])])]),s("p",[t._v("如果能根据日志知道是哪个区就先确定哪个区")]),t._v(" "),s("p",[t._v("而在Java内存结构中，发生内存溢出的情况如下")]),t._v(" "),s("ul",[s("li",[t._v("堆区：对象太多没有空间分配（例如加载一个很大的数据到内存），对象没有正确回收，到时内存泄露，占用内存，最终溢出。")]),t._v(" "),s("li",[t._v("方法区：内存配置较少，加载太多class信息，导致溢出，这种通过jvm调整方法区大小解决")]),t._v(" "),s("li",[t._v("栈区：调用链过深导致很多对象加载到内存")]),t._v(" "),s("li",[t._v("本地方法区：依赖太多本地方法，导致溢出。")])]),t._v(" "),s("p",[t._v("一般大部分出现内存溢出主要原因就是加载对象过多或者垃圾回收不了（内存泄露）")]),t._v(" "),s("p",[t._v("解决步骤：")]),t._v(" "),s("ol",[s("li",[t._v("使用jps/ps 找到应用进程pid")]),t._v(" "),s("li",[t._v("使用jmap 查询当前的内存占用情况，找到可以的大对象")]),t._v(" "),s("li",[t._v("jstat命令看看堆区情况和gc情况，结合GC情况一起分析")]),t._v(" "),s("li",[t._v("使用分析工具分析jmap dump的出来的信息，查找无效引用")]),t._v(" "),s("li",[t._v("结合代码分析是否正常")]),t._v(" "),s("li",[t._v("考虑是否调整jvm参数，调整分区大小，如果有频繁的GC，考虑配置分区的比例。")])]),t._v(" "),s("h3",{attrs:{id:"_3-3-栈溢出问题处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-栈溢出问题处理"}},[t._v("#")]),t._v(" 3.3 栈溢出问题处理")]),t._v(" "),s("p",[t._v("栈溢出主要是集中在栈区，主要产生原因就是超出了栈的深度设置，结合代码分析，是否必须要调大栈深度还是优化代码。")]),t._v(" "),s("h3",{attrs:{id:"_3-4-频繁gc问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-频繁gc问题"}},[t._v("#")]),t._v(" 3.4 频繁GC问题")]),t._v(" "),s("ol",[s("li",[t._v("如果有OOM的话，根据分析dump的情况，结合代码看是或否是代码的漏洞，如果有代码漏洞，修复代码(如：不小心写了产生死循环的代码)")]),t._v(" "),s("li",[t._v("如果代码没有问题，可能是之前JVM设置的内存过小，调整JVM参数设置")]),t._v(" "),s("li",[t._v("如果没有OOM，而是频繁的GC。分析调整 young old 的占比(-XX:NewRatio)，survivor的占比(-XX:SurvivorRatio)，考虑年轻代和老年代大小是否合适。")])]),t._v(" "),s("h3",{attrs:{id:"_3-5-jvm常见问题排查示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-jvm常见问题排查示例"}},[t._v("#")]),t._v(" 3.5 JVM常见问题排查示例")]),t._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://blog.csdn.net/fishinhouse/article/details/80781673",target:"_blank",rel:"noopener noreferrer"}},[t._v("Java内存泄漏的排查总结"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/QG-whz/p/9647614.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从一次线上故障思考Java问题定位思路"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.analysys.cn/article/detail/20019016",target:"_blank",rel:"noopener noreferrer"}},[t._v("jvm疯狂吞占内存，罪魁祸首是谁？"),s("OutboundLink")],1)])]),t._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1552089",target:"_blank",rel:"noopener noreferrer"}},[t._v("记一次生产频繁出现 Full GC 的 GC日志图文详解"),s("OutboundLink")],1)])])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/36597907",target:"_blank",rel:"noopener noreferrer"}},[t._v("JVM内存模型分析04篇-调优工具使用介绍"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/QG-whz/p/9647614.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从一次线上故障思考Java问题定位思路"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.analysys.cn/article/detail/20019016",target:"_blank",rel:"noopener noreferrer"}},[t._v("jvm疯狂吞占内存，罪魁祸首是谁？"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://tech.meituan.com/2017/12/29/jvm-optimize.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从实际案例聊聊Java应用的GC优化"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1552089",target:"_blank",rel:"noopener noreferrer"}},[t._v("记一次生产频繁出现 Full GC 的 GC日志图文详解"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://my.oschina.net/u/347386/blog/1552781",target:"_blank",rel:"noopener noreferrer"}},[t._v("一步步优化JVM四：决定Java堆的大小以及内存占用"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://youyou-tech.com/2019/11/22/%E6%AF%8F%E5%A4%A9%E7%99%BE%E4%B8%87%E4%BA%A4%E6%98%93%E7%9A%84%E6%94%AF%E4%BB%98%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E8%AF%A5%E6%80%8E%E4%B9%88%E8%AE%BE/",target:"_blank",rel:"noopener noreferrer"}},[t._v("每天百万交易的支付系统，生产环境该怎么设置JVM堆内存大小"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);