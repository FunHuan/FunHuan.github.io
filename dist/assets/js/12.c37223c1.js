(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{636:function(v,t,A){v.exports=A.p+"assets/img/ratelimit-01.b4d78615.png"},637:function(v,t,A){v.exports=A.p+"assets/img/ratelimit-02.abfa0df4.png"},638:function(v,t){v.exports="data:image/png;base64,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"},639:function(v,t,A){v.exports=A.p+"assets/img/ratelimit-04.f33c62f9.png"},640:function(v,t,A){v.exports=A.p+"assets/img/ratelimit-05.ef7d7f86.png"},732:function(v,t,A){"use strict";A.r(t);var r=A(4),a=Object(r.a)({},(function(){var v=this,t=v.$createElement,r=v._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[r("h1",{attrs:{id:"高并发-限流"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#高并发-限流"}},[v._v("#")]),v._v(" 高并发：限流")]),v._v(" "),r("p",[v._v("处理高并发的三板斧：缓存、限流、熔断降级")]),v._v(" "),r("p",[v._v("本文将来接收下关于限流的那些事儿")]),v._v(" "),r("h2",{attrs:{id:"_1-认识限流"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-认识限流"}},[v._v("#")]),v._v(" 1 认识限流")]),v._v(" "),r("p",[v._v("什么是限流？为什么要做限流？这两个问题的答案其实是一样的。")]),v._v(" "),r("p",[v._v("每个系统都有服务的上线，所以当流量超过服务极限能力时，系统可能会出现卡死、崩溃的情况，所以就有了降级和限流。限流其实就是：当高并发或者瞬时高并发时，为了保证系统的稳定性、可用性，系统以牺牲部分请求为代价或者延迟处理请求为代价，"),r("strong",[v._v("保证系统整体服务可用。")])]),v._v(" "),r("p",[v._v("常见的限流场景：秒杀、抢购 等大流量场景")]),v._v(" "),r("h2",{attrs:{id:"_2-限流算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-限流算法"}},[v._v("#")]),v._v(" 2 限流算法")]),v._v(" "),r("p",[v._v("要做限流，通常有三种算法思想 令牌桶算法、漏桶算法、计数器算法。")]),v._v(" "),r("p",[v._v("其中，令牌桶和漏桶就是一个经典的生产者消费者模型，前者控制生产速率，后者控制消息速率。如果自己实现的话，就是用一个生产线程配合一个消费线程实现。")]),v._v(" "),r("h3",{attrs:{id:"_2-1-令牌桶算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-令牌桶算法"}},[v._v("#")]),v._v(" 2.1 令牌桶算法")]),v._v(" "),r("p",[r("img",{attrs:{src:A(636),alt:""}})]),v._v(" "),r("p",[r("strong",[v._v("令牌桶算法基本流程：")])]),v._v(" "),r("ol",[r("li",[r("p",[v._v("通过一定的速率往桶内添加令牌")])]),v._v(" "),r("li",[r("p",[v._v("请求过来的时候，如果桶内有令牌，则获取令牌成功，接收请求并处理")])]),v._v(" "),r("li",[r("p",[v._v("请求过来的时候，如果桶内没有令牌，则获取令牌失败，拒绝请求")])])]),v._v(" "),r("p",[r("strong",[v._v("特点：")])]),v._v(" "),r("p",[v._v("​\t1.令牌桶算法通过固定的速率生成令牌的方式控制流入速率")]),v._v(" "),r("p",[v._v("​    2.利用桶作为令牌的缓存空间，可以积压一部分的令牌，从而可以允许一定程度的突发流量（只要桶内有令牌，可以一次拿多个）")]),v._v(" "),r("p",[r("strong",[v._v("实现举例：")])]),v._v(" "),r("p",[v._v("​\tGuava 中的 RateLimiter 接口对应的实现")]),v._v(" "),r("h3",{attrs:{id:"_2-2-漏桶算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-漏桶算法"}},[v._v("#")]),v._v(" 2.2 漏桶算法")]),v._v(" "),r("p",[r("img",{attrs:{src:A(637),alt:""}})]),v._v(" "),r("p",[r("strong",[v._v("漏桶算法基本流程：")])]),v._v(" "),r("ol",[r("li",[v._v("请求进入后，立马接收，放入桶中排队，如果桶容量满了，则拒绝请求。")]),v._v(" "),r("li",[v._v("桶内请求，按照固定的速率去消费。即以平均速率流出。")])]),v._v(" "),r("p",[r("strong",[v._v("特点：")])]),v._v(" "),r("p",[v._v("​\t1.漏桶算法主要限制的是流出速率")]),v._v(" "),r("p",[v._v("​    2.通过桶作为缓存，降低请求压力")]),v._v(" "),r("p",[r("strong",[v._v("实现举例：")])]),v._v(" "),r("p",[v._v("​\t平时业务中使用消息队列削峰，按照一定速率消费消息。")]),v._v(" "),r("h3",{attrs:{id:"_2-3-计数器算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-计数器算法"}},[v._v("#")]),v._v(" 2.3 计数器算法")]),v._v(" "),r("p",[r("img",{attrs:{src:A(638),alt:""}})]),v._v(" "),r("p",[r("strong",[v._v("计数器算法基本流程：")])]),v._v(" "),r("ol",[r("li",[v._v("设定一个计数器记录请求的数量")]),v._v(" "),r("li",[v._v("请求进来是，判断是否超出数量，超出则拒绝，未超出接收处理")])]),v._v(" "),r("p",[r("strong",[v._v("特点：")])]),v._v(" "),r("p",[v._v("​\t1.依赖计数器记录数量值做判断")]),v._v(" "),r("p",[v._v("​    2.可以灵活的根据不同需要，设置多个计数器，如 用户id， 请求ip等")]),v._v(" "),r("p",[r("strong",[v._v("实现举例：")])]),v._v(" "),r("p",[v._v("​\t数据库连接池大小、线程池大小、程序访问并发数等")]),v._v(" "),r("h3",{attrs:{id:"_2-4-固定窗口算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-固定窗口算法"}},[v._v("#")]),v._v(" 2.4 固定窗口算法")]),v._v(" "),r("p",[r("img",{attrs:{src:A(639),alt:""}})]),v._v(" "),r("p",[r("strong",[v._v("固定窗口算法基本流程：")])]),v._v(" "),r("ol",[r("li",[r("p",[v._v("按时间划分为多个限流窗口，比如1秒为一个限流窗口大小；")])]),v._v(" "),r("li",[r("p",[v._v("每个窗口都有一个计数器，每通过一个请求计数器会加一；")])]),v._v(" "),r("li",[r("p",[v._v("当计数器大小超过了限制大小（比如一秒内只能通过100个请求），则窗口内的其他请求会被丢弃或排队等待，等到下一个时间节点计数器清零再处理请求。")])])]),v._v(" "),r("p",[v._v("固定窗口算法的理想流量控制效果如上左侧图所示，假定设置1秒内允许的最大请求数为100，那么1秒内的最大请求数不会超过100。")]),v._v(" "),r("p",[v._v("但是大多数情况下我们会得到右侧的曲线图，即可能会出现流量翻倍的效果。比如前T1~T2时间段没有请求，T2~T3来了100个请求，全部通过。下一个限流窗口计数器清零，然后T3~T4时间内来了100个请求，全部处理成功，这个时候时间段T4~T5时间段就算有请求也是不能处理的，因此超过了设定阈值，最终T2~T4这一秒时间处理的请求为200个，所以流量翻倍。")]),v._v(" "),r("p",[r("strong",[v._v("特点")])]),v._v(" "),r("ul",[r("li",[v._v("算法易于理解，实现简单；")]),v._v(" "),r("li",[v._v("流量控制不够精细，容易出现流量翻倍情况；")]),v._v(" "),r("li",[v._v("适合流量平缓并允许流量翻倍的模型。")])]),v._v(" "),r("h3",{attrs:{id:"_2-5-滑动窗口算法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-滑动窗口算法"}},[v._v("#")]),v._v(" 2.5 滑动窗口算法")]),v._v(" "),r("p",[r("img",{attrs:{src:A(640),alt:""}})]),v._v(" "),r("p",[v._v("前面提到固定窗口算法容易出现流量控制不住的情况（流量翻倍），滑动窗口可以认为是固定窗口的升级版本，可以规避固定窗口导致的流量翻倍问题。")]),v._v(" "),r("p",[r("strong",[v._v("滑动窗口基本流程：")])]),v._v(" "),r("ol",[r("li",[r("p",[v._v("时间窗口被细分若干个小区间，比如之前一秒一个窗口（最大允许通过60个请求），现在一秒分成3个小区间，每个小区间最大允许通过20个请求；")])]),v._v(" "),r("li",[r("p",[v._v("每个区间都有一个独立的计数器，可以理解一个区间就是固定窗口算法中的一个限流窗口；")])]),v._v(" "),r("li",[r("p",[v._v("当一个区间的时间用完，滑动窗口往后移动一个分区，老的分区(T1~T2)被丢弃，新的分区(T4~T5)加入滑动窗口，如上图所示。")])])]),v._v(" "),r("p",[r("strong",[v._v("小结")])]),v._v(" "),r("ul",[r("li",[v._v("流量控制更加精准，解决了固定窗口算法导致的流量翻倍问题；")]),v._v(" "),r("li",[v._v("区间划分粒度不易确定，粒度太小会增加计算资源，粒度太大又会导致整体流量曲线不够平滑，使得系统负载忽高忽低；")]),v._v(" "),r("li",[v._v("适合流量较为稳定，没有大量流量突增模型。")])]),v._v(" "),r("h2",{attrs:{id:"_3-限流方案"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-限流方案"}},[v._v("#")]),v._v(" 3 限流方案")]),v._v(" "),r("p",[v._v("熟悉限流算法思想后，在日常项目中，需要用到限流，基本就按照上面的思想来操作。而实际的限流有分为不同层级的处理，方式上也略有不同。 主要分为 应用层级别（单机级别） 和 接入层级别（分布式级别）")]),v._v(" "),r("h3",{attrs:{id:"_3-1-应用层限流"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-应用层限流"}},[v._v("#")]),v._v(" 3.1 应用层限流")]),v._v(" "),r("p",[v._v("应用级别的限流，顾名思义，就是在应用实例上做相关的限流处理。当请求转发到应用实例后，采用相关限流算法进行限流。")]),v._v(" "),r("p",[r("strong",[v._v("常见实现")])]),v._v(" "),r("ol",[r("li",[v._v("调整tomcat的链接池 控制请求并发量（计数器算法）")]),v._v(" "),r("li",[v._v("应用代码API层加入切面，结合类似 Guava的 RateLimiter 实现令牌桶算法，控制api接口访问速率")]),v._v(" "),r("li",[v._v("微服务组件中做限流，例如：Hystrix、Sentinel")])]),v._v(" "),r("p",[r("strong",[v._v("特点：")])]),v._v(" "),r("p",[v._v("​\t应用级限流由于是处理应用实例级别，单机环境下能够很好满足要求，但是分布式环境下，可能不太适合，他只能限制单机的情况。虽分布情况下，需要用到相关的分布式限流方式。")]),v._v(" "),r("p",[v._v("​\t虽然应用内限流不能应对分布式场景，但是对单机而言，还是挺有用，可以通过限流来避免单机负载过高。但是需要注意一点，一定要确保请求被拒是否合乎业务上的逻辑，实现一定要结合业务来看。")]),v._v(" "),r("h3",{attrs:{id:"_3-2-接入层限流"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-接入层限流"}},[v._v("#")]),v._v(" 3.2 接入层限流")]),v._v(" "),r("p",[v._v("分布式环境下，一般选择在网关或者nginx，即接入层级别去做，达到全局的限流目的。")]),v._v(" "),r("p",[r("strong",[v._v("常见实现")])]),v._v(" "),r("ol",[r("li",[v._v("redis+lua 脚本")]),v._v(" "),r("li",[v._v("nginx+lua脚本或者nginx的限流模块")]),v._v(" "),r("li",[v._v("openresty中做限流")]),v._v(" "),r("li",[v._v("微服务网关组件中做限流Spirng Cloud Gateway、zuul 等")])]),v._v(" "),r("p",[r("strong",[v._v("特点：")])]),v._v(" "),r("p",[v._v("​\t通过在接入加入限流逻辑，实现全局的限流目的，控制整个服务网络的流量情况，保证整个服务集群的可用性。")]),v._v(" "),r("h3",{attrs:{id:"_3-3-客户端限流"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-客户端限流"}},[v._v("#")]),v._v(" 3.3 客户端限流")]),v._v(" "),r("p",[v._v("客户端加入控制，显示频繁的操作。")]),v._v(" "),r("p",[v._v("实际生产中，大部分都是分布式服务场景，因此接入层的限流用到的最多。")]),v._v(" "),r("hr"),v._v(" "),r("p",[v._v("参考资料：")]),v._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://www.pdai.tech/md/arch/arch-y-ratelimit.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("架构之高并发：限流"),r("OutboundLink")],1)]),v._v(" "),r("li",[r("a",{attrs:{href:"https://blog.csdn.net/fenglvming/article/details/51996406",target:"_blank",rel:"noopener noreferrer"}},[v._v("nginx + lua + redis 防刷和限流"),r("OutboundLink")],1)]),v._v(" "),r("li",[r("a",{attrs:{href:"https://blog.52itstyle.vip/archives/2982/?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io",target:"_blank",rel:"noopener noreferrer"}},[v._v("从构建分布式秒杀系统聊聊限流特技"),r("OutboundLink")],1)]),v._v(" "),r("li",[v._v("["),r("a",{attrs:{href:"https://www.cnblogs.com/cmfwm/p/8032994.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("高并发系统之限流特技"),r("OutboundLink")],1),v._v("]")])])])}),[],!1,null,null,null);t.default=a.exports}}]);