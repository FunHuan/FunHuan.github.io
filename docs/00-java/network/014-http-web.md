---
title: 打开网页到看到页面，到底经历了哪些？
date: 2021-04-08
categories:
 - 基础知识
tags:
 - 网络编程
 - http
---



# 打开网页到看到页面，到底经历了哪些过程？

上网已经成为我们每个人生活中一项重要的内容了，当我们打开浏览器，在地址栏中输入相应的网址并按下了回车键，既会在页面中呈现所需的相关信息。那么，在这背后都进行了哪些技术步骤，才会将丰富的信息内容加载出来，展现在我们眼前呢。

从URL的输入到页面的展现，大概会经过以下几个过程：

1. 在浏览器中输入url

2. DNS域名解析

3. 建立通讯通

4. 服务器处理请求并返回

5. 关闭通道

6. 浏览器显示页面信息

<!-- more -->

## 1 URL的输入

在地址栏输入的**url（Uniform Resource Locator,统一资源定位符）**，是一切的开始部分。关于url有以下几点

1. 协议
2. 域名
3. 端口
4. 文件路径

通常格式为 `schema://domain:port/path  `

例如 `http://www.jnote.net/00-java/network/014-http-web.html`

接下来以网址 http://www.jnote.net/00-java/network/014-http-web.html 为例来分析下

### 1.1协议

通过特定的传输协议，获得指定文档的内容。

在Internet中可以使用多种协议。常见的协议有：” http:// ” （超文本传输协议，信息是明文传输）、“ https:// ”（进行加密的网络传输协议）、" file:// "（本地文件传输协议，file协议主要用于访问本地计算机中的文件）、" ftp:// "（文件传输协议），" mailto: "（资源为电子邮件地址，通过SMTP访问）。还有一种URL前面没有加指定协议，它是指获取该资源需要使用的协议与当前的URL是保持一致的。

示例网址协议部分为 http，代表交互使用http协议进行

 ### 1.2 域名

用来确定服务器在互联网上的位置，域名的目的是便于记忆和沟通的一组服务器的地址，是唯一不可重复的

示例网址域名为：`www.jnote.net`

### 1.3 端口

跟在域名后面的为端口编号，域名和端口之间使用“ ：”分隔开。默认端口一般在URL中不展现。当Web服务器采用的不是默认端口时，就需要写明服务所用的端口。端口号的作用，主要是区分服务类别和在同一时间进行多个会话。

示例网址使用了http协议默认端口80 所以没有展示

### 1.4 文件路径

一般用来表示主机上的一个目录或文件地址（即存储的位置），由零或多个“ / ”符号隔开，划分为多个层次进行描述。

示例网址文件路径为 `/00-java/network/014-http-web.html`



 ## 2 DNS解析

当网址数据完成并回车后，这个时候就需要和服务端交互，交互之前第一步要做的就是需要知道交互的人是谁，在互联网世界中，所有的节点都基于一个ip来进行。域名是用来代替ip方便记忆的，所以在访问页面的时候，需要把域名解析成ip，整个过程就是DNS解析过程。



### 2.1 域名解析的流程

1. **查找浏览器缓存**——我们日常浏览网站时，浏览器会缓存DNS记录一段时间。如果以前我们访问过该网站，那么在浏览器中就会有相应的缓存记录。因此，我们输入网址后，浏览器会首先检查缓存中是否有该域名对应的IP信息。如果有，则直接返回该信息供用户访问网站，如果查询失败，会从系统缓存中进行查找。
2. **查找系统缓存**——从hosts文件中查找是否有存储的DNS信息（MAC端，可在“终端”中输入命令cat etc/hosts找到hosts文件位置），如果查询失败，可从路由器缓存中继续查找。
3. **查找路由器缓存**——如果之前访问过相应的网站，一般路由器也会缓存信息。如果查询失败，可继续从 ISP DNS 缓存查找。
4. **查找ISP DNS缓存**——从网络服务商（例如电信）的DNS缓存信息中查找。
5. 如果经由以上方式都没找到对应IP的话，则向**根域名服务器查找**域名对应的IP地址，根域名服务器把请求转发到下一级，逐层查找该域名的对应数据，直到获得最终解析结果或失败的相应。

**根域名服务器，**根服务器主要用来管理互联网的主目录。是互联网域名解析系统（DNS）中最高级别的域名服务器。



## 3 建立通讯通道

经过DNS解析之后，客户端（浏览器）知道目标服务器的ip，这个时候会经过TCP三次握手协议，与服务端建立通讯的通道，用来传输数据。关于TCP三次握手可参考 [TCP三次握手与四次挥手](http://www.jnote.net/00-java/network/011-tcp.html)

通道建立成功后，浏览器和请求发送给服务器，等待服务器的返回。



## 4 服务端处理数据并返回

服务端接收到请求后，由于服务端架构比较复杂，中间可能有 硬件负载均衡（如：F5）、LVS负载均衡、nginx七层负载均衡、应用服务器 等。所以会存在一些请求分配转发

LVS负载均衡：工作在四层，根据定义的负载均衡策略，把请求转发到下一级的服务器

nginx 负载均衡：工作在七层，可以根据访问的路径，把请求转发给下一层的服务器

应用服务器处理：接收请求，并处理业务逻辑，返回相关数据



应用服务器处理完数据之后，一次传递给nginx、lvs、硬件负载均衡设备等，最后发送给客户端（浏览器）



## 5 接收数据关闭通道

客户端通过之前建立的TCP通道，接收数据，根据http协议确认报文是否接收完毕，然后与服务进行四次挥手关闭通道 ，关于TCP四次挥手可参考 [TCP三次握手与四次挥手](http://www.jnote.net/00-java/network/011-tcp.html)



## 6 浏览器渲染页面

浏览器接收到数据，然后按照http的报文格式进行解析，获取到页面的真实内容，调用浏览器的渲染引擎，把页面展示出来，至此，整个页面得以呈现。



## 7 总结

总结来讲，从输入地址到看到页面，经历了一下过程

1. 在浏览器中输入url
2. DNS域名解析
3. 建立通讯通
4. 服务器处理请求并返回
5. 关闭通道
6. 浏览器显示页面信息

其中每一个过程的细节也是非常的值得深入研究的，这里只是简单接收下大致流程，有兴趣的朋友可以再深入去了解。